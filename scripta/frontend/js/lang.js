const translations = {
    az: {
        home: 'Ana səhifə',
        new: 'Yeniliklər',
        favorites: 'Sevimlilər',
        about: 'Haqqımızda',
        catalog: 'Kataloq',
        search: 'Kitab axtar...',
        selectLanguage: 'Dil seçin',
        heroTitle: 'Şəxsi kitabxanan cibindədir',
        heroSubtitle: '5 000-dən çox kitab bir saytda',
        startReading: 'Pulsuz oxumağa başla',
        recommended: 'Tövsiyə edirik',
        best: 'Ən yaxşılar',
        viewAll: 'Hamısına bax',
        genres: 'Janrlar',
        footerText: 'Onlayn kitabxananız',
        aboutLink: 'Platforma haqqında',
        contactLink: 'Əlaqə',
        privacyLink: 'Məxfilik',
        allRights: 'Bütün hüquqlar qorunur',
        aboutHeroTitle: 'Scripta — təhsil və inkişaf üçün rəqəmsal kitabxana',
        aboutHeroSubtitle: 'Biliyə açıq giriş, müasir dizayn və rahat oxu — hamısı bir yerdə',
        aboutMissionTitle: 'Missiyamız',
        aboutMissionText: 'Biz inanırıq ki, bilik hər kəs üçün əlçatan olmalıdır — yerdən, zamandan və imkanlardan asılı olmayaraq. Scripta oxucu ilə kitab arasındakı maneələri aradan qaldırmaq üçün yaradılıb.',
        aboutPointAccess: 'Biliyə çıxış',
        aboutPointAccessDesc: 'Müxtəlif istiqamətlər üzrə minlərlə kitab — klassikadan müasir elmə qədər',
        aboutPointSpeed: 'Sürət və sadəlik',
        aboutPointSpeedDesc: 'Sürətli axtarış, rahat filtrlər və oxuya ani giriş',
        aboutPointGlobal: 'Sərhədsiz təhsil',
        aboutPointGlobalDesc: 'Platforma hər yerdə işləyir — yalnız brauzer və öyrənmək istəyi lazımdır',
        aboutAudienceTitle: 'Scripta kimin üçündür',
        aboutCardStudents: 'Tələbələr',
        aboutCardStudentsDesc: 'Dərs ədəbiyyatı, konspektlər və klassik əsərlər — uğurlu təhsil üçün hər şey',
        aboutCardSelflearn: 'Özünütəhsil edənlər',
        aboutCardSelflearnDesc: 'Özünüinkişaf, dillər, proqramlaşdırma — istənilən bacarıq üçün materiallar tapın',
        aboutCardReaders: 'Oxu həvəskarları',
        aboutCardReadersDesc: 'Bədii ədəbiyyat, bestselerlər və nadir tapıntılar — əsl kitabsevərlər üçün',
        aboutAdvTitle: 'Scripta nə ilə fərqlənir',
        aboutAdv1: 'Təmiz interfeys',
        aboutAdv1Desc: 'Artıq heç nə yoxdur — yalnız kitablar və rahat naviqasiya',
        aboutAdv2: 'Müasir dizayn',
        aboutAdv2Desc: 'Qaranlıq və işıqlı mövzular, hamar animasiyalar, xoş tipografiya',
        aboutAdv3: 'Sürətli axtarış və filtrlər',
        aboutAdv3Desc: 'Lazım olan kitabı saniyələr ərzində tapın — ad, müəllif və ya janr üzrə',
        aboutAdv4: 'Onlayn oxu',
        aboutAdv4Desc: 'Birbaşa brauzerdə oxuyun — yükləmə və qeydiyyat olmadan',
        aboutHowTitle: 'Bu necə işləyir',
        aboutStep1: 'Kitab tapın',
        aboutStep1Desc: 'Axtarışdan və ya janr kataloqündan istifadə edin',
        aboutStep2: 'Kitab səhifəsini açın',
        aboutStep2Desc: 'Təsviri, reytinqi və rəyləri görün',
        aboutStep3: 'Onlayn oxuyun',
        aboutStep3Desc: 'Birbaşa brauzerdə oxumağa başlayın',
        aboutStep4: 'Sevimlilərə əlavə edin',
        aboutStep4Desc: 'Kitabı bir kliklə kolleksiyaya əlavə edin',
        aboutPrinciplesTitle: 'Prinsiplərimiz',
        aboutPr1: 'Sadəlik',
        aboutPr2: 'İstifadəçiyə diqqət',
        aboutPr3: 'Biliyə hörmət',
        aboutPr4: 'Daimi təkmilləşdirmə',
        aboutFutureTitle: 'Layihənin gələcəyi',
        aboutFutureText: 'Scripta böyüməyə davam edir. Biz kataloqün genişləndirilməsi, fərdi tövsiyələr, mobil tətbiq və təhsil platformaları ilə inteqrasiya üzərində işləyirik. Məqsədimiz — biliyə can atan hər kəs üçün əsas rəqəmsal kitabxana olmaqdır.',
        aboutContactTitle: 'Bizimlə əlaqə',
        aboutFormName: 'Ad',
        aboutFormNamePh: 'Adınız',
        aboutFormMsg: 'Mesaj',
        aboutFormMsgPh: 'Mesajınızı yazın...',
        aboutFormSend: 'Göndər',
        aboutFormSuccess: 'Təşəkkür edirik! Mesajınız göndərildi.',
        aboutContactDirect: 'Və ya birbaşa bizə yazın:',
        favSubtitle: 'Saxladığınız kitablar',
        favEmptyTitle: 'Hələ heç nə yoxdur',
        favEmptyText: 'Kitabı sevimlilərə əlavə etmək üçün kartdakı ürəyə basın',
        favGoToBooks: 'Kitablara keç',
        catalogSubtitle: 'Kitabxanamızdakı bütün kitablar',
        catalogCategory: 'Kateqoriya',
        catalogGenre: 'Janr',
        catalogRating: 'Reytinq',
        catalogReset: 'Filtrləri sıfırla',
        catalogNoResults: 'Heç nə tapılmadı',
        categoryFilter: 'Kateqoriya',
        resetFilters: 'Filtrləri sıfırla',
        noResults: 'Kitab tapılmadı',
        privacyTitle: 'Məxfilik siyasəti',
        privacySubtitle: 'Məlumatlarınızı necə qoruyuruq',
        privacyCollect: 'Hansı məlumatları toplayırıq',
        privacyCollectText: 'Xidmətin işləməsi üçün lazım olan minimum məlumatları toplayırıq: interfeys dili, tərtibat mövzusu və seçilmiş kitabların siyahısı. Bu məlumatlar brauzerinizin localStorage-da saxlanılır və üçüncü tərəflərin serverlərinə ötürülmür.',
        privacyUse: 'Məlumatları necə istifadə edirik',
        privacyUseText: 'Toplanmış məlumatlar yalnız təcrübənizi fərdiləşdirmək üçün istifadə olunur: interfeysin seçilmiş dildə göstərilməsi, tərtibat mövzusunun və seçilmiş kitablar siyahısının sessiyalar arasında saxlanması.',
        privacyCookies: 'Cookie faylları',
        privacyCookiesText: 'Saytımız izləmə üçün cookie fayllarından istifadə etmir. Bütün istifadəçi seçimləri brauzerinizin localStorage vasitəsilə saxlanılır.',
        privacyThirdParty: 'Üçüncü tərəflər',
        privacyThirdPartyText: 'Biz şəxsi məlumatlarınızı üçüncü tərəflərə ötürmürük, satmırıq və təqdim etmirik. API serveri ilə əlaqə yalnız kitab kataloqünün yüklənməsi üçün həyata keçirilir.',
        privacySecurity: 'Təhlükəsizlik',
        privacySecurityText: 'Məlumatların qorunması üçün ağlabatan tədbirlər görürük. Serverlə bütün əlaqələr qorunan protokol vasitəsiyle həyata keçirilir. Məlumatlarınız yalnız cihazınızda saxlanılır.',
        privacyRights: 'Hüquqlarınız',
        privacyRightsText: 'İstənilən vaxt brauzer parametrlərində localStorage-ı təmizləyərək bütün saxlanmış məlumatları silə bilərsiniz. Suallarınız yaranarsa, «Haqqımızda» səhifəsi vasitəsilə bizimlə əlaqə saxlayın.',
        // Book page
        author: 'Müəllif',
        genre: 'Janr',
        year: 'İl',
        language: 'Dil',
        pages: 'Səhifə',
        description: 'Təsvir',
        formats: 'Formatlar',
        readOnline: 'Onlayn oxu',
        download: 'Yüklə',
        views: 'baxış',
        downloads: 'yükləmə'
    },

    ru: {
        home: 'Главная',
        new: 'Новинки',
        favorites: 'Избранное',
        about: 'О нас',
        catalog: 'Каталог',
        search: 'Поиск книг...',
        selectLanguage: 'Выберите язык',
        heroTitle: 'Твоя личная библиотека в кармане',
        heroSubtitle: 'Более 5 000 книг в одном сайте',
        startReading: 'Начать читать бесплатно',
        recommended: 'Рекомендуем',
        best: 'Лучшие',
        viewAll: 'Открыть все',
        genres: 'Жанры',
        footerText: 'Ваша онлайн библиотека',
        aboutLink: 'О платформе',
        contactLink: 'Контакты',
        privacyLink: 'Конфиденциальность',
        allRights: 'Все права защищены',
        aboutHeroTitle: 'Scripta — цифровая библиотека для обучения и развития',
        aboutHeroSubtitle: 'Открытый доступ к знаниям, современный дизайн и удобство чтения — всё в одном месте',
        aboutMissionTitle: 'Наша миссия',
        aboutMissionText: 'Мы верим, что знания должны быть доступны каждому — вне зависимости от места, времени и возможностей. Scripta создана, чтобы убрать барьеры между читателем и книгой.',
        aboutPointAccess: 'Доступ к знаниям',
        aboutPointAccessDesc: 'Тысячи книг по разным направлениям — от классики до современной науки',
        aboutPointSpeed: 'Скорость и простота',
        aboutPointSpeedDesc: 'Быстрый поиск, удобные фильтры и мгновенный доступ к чтению',
        aboutPointGlobal: 'Образование без границ',
        aboutPointGlobalDesc: 'Платформа работает везде — нужен только браузер и желание учиться',
        aboutAudienceTitle: 'Для кого Scripta',
        aboutCardStudents: 'Студенты',
        aboutCardStudentsDesc: 'Учебная литература, конспекты и классические произведения — всё для успешной учёбы',
        aboutCardSelflearn: 'Самоучки',
        aboutCardSelflearnDesc: 'Саморазвитие, языки, программирование — находите материалы под любой навык',
        aboutCardReaders: 'Любители чтения',
        aboutCardReadersDesc: 'Художественная литература, бестселлеры и редкие находки — для настоящих книголюбов',
        aboutAdvTitle: 'Чем Scripta отличается',
        aboutAdv1: 'Чистый интерфейс',
        aboutAdv1Desc: 'Ничего лишнего — только книги и удобная навигация',
        aboutAdv2: 'Современный дизайн',
        aboutAdv2Desc: 'Тёмная и светлая темы, плавные анимации, приятная типографика',
        aboutAdv3: 'Быстрый поиск и фильтры',
        aboutAdv3Desc: 'Находите нужную книгу за секунды — по названию, автору или жанру',
        aboutAdv4: 'Онлайн чтение',
        aboutAdv4Desc: 'Читайте прямо в браузере — без скачивания и регистрации',
        aboutHowTitle: 'Как это работает',
        aboutStep1: 'Найдите книгу',
        aboutStep1Desc: 'Используйте поиск или каталог жанров',
        aboutStep2: 'Откройте страницу книги',
        aboutStep2Desc: 'Посмотрите описание, рейтинг и отзывы',
        aboutStep3: 'Читайте онлайн',
        aboutStep3Desc: 'Начните чтение прямо в браузере',
        aboutStep4: 'Сохраните в избранное',
        aboutStep4Desc: 'Добавьте книгу в коллекцию одним нажатием',
        aboutPrinciplesTitle: 'Наши принципы',
        aboutPr1: 'Простота',
        aboutPr2: 'Фокус на пользователе',
        aboutPr3: 'Уважение к знаниям',
        aboutPr4: 'Постоянное улучшение',
        aboutFutureTitle: 'Будущее проекта',
        aboutFutureText: 'Scripta продолжает расти. Мы работаем над расширением каталога, персональными рекомендациями, мобильным приложением и интеграцией с образовательными платформами. Наша цель — стать главной цифровой библиотекой для каждого, кто стремится к знаниям.',
        aboutContactTitle: 'Связаться с нами',
        aboutFormName: 'Имя',
        aboutFormNamePh: 'Ваше имя',
        aboutFormMsg: 'Сообщение',
        aboutFormMsgPh: 'Напишите ваше сообщение...',
        aboutFormSend: 'Отправить',
        aboutFormSuccess: 'Спасибо! Ваше сообщение отправлено.',
        aboutContactDirect: 'Или напишите нам напрямую:',
        favSubtitle: 'Книги, которые вы сохранили',
        favEmptyTitle: 'Пока ничего нет',
        favEmptyText: 'Нажмите на сердечко на карточке книги, чтобы добавить её в избранное',
        favGoToBooks: 'Перейти к книгам',
        catalogSubtitle: 'Все книги нашей библиотеки',
        catalogCategory: 'Категория',
        catalogGenre: 'Жанр',
        catalogRating: 'Рейтинг',
        catalogReset: 'Сбросить фильтры',
        catalogNoResults: 'Ничего не найдено',
        categoryFilter: 'Категория',
        resetFilters: 'Сбросить фильтры',
        noResults: 'Книги не найдены',
        privacyTitle: 'Политика конфиденциальности',
        privacySubtitle: 'Как мы защищаем ваши данные',
        privacyCollect: 'Какие данные мы собираем',
        privacyCollectText: 'Мы собираем минимальный объём данных, необходимый для работы сервиса: язык интерфейса, тема оформления и список избранных книг. Эти данные хранятся локально в вашем браузере (localStorage) и не передаются на серверы третьих лиц.',
        privacyUse: 'Как мы используем данные',
        privacyUseText: 'Собранные данные используются исключительно для персонализации вашего опыта: отображение интерфейса на выбранном языке, сохранение темы оформления и списка избранных книг между сессиями.',
        privacyCookies: 'Файлы cookie',
        privacyCookiesText: 'Наш сайт не использует файлы cookie для отслеживания. Все пользовательские предпочтения сохраняются через localStorage вашего браузера.',
        privacyThirdParty: 'Третьи стороны',
        privacyThirdPartyText: 'Мы не передаём, не продаём и не предоставляем ваши персональные данные третьим лицам. Взаимодействие с API-сервером происходит только для загрузки каталога книг.',
        privacySecurity: 'Безопасность',
        privacySecurityText: 'Мы принимаем разумные меры для защиты данных. Все соединения с сервером осуществляются по защищённому протоколу. Ваши данные хранятся только на вашем устройстве.',
        privacyRights: 'Ваши права',
        privacyRightsText: 'Вы можете в любой момент удалить все сохранённые данные, очистив localStorage в настройках браузера. При возникновении вопросов свяжитесь с нами через страницу «О нас».',
        // Book page
        author: 'Müəllif',
        genre: 'Janr',
        year: 'İl',
        language: 'Dil',
        pages: 'Səhifə',
        description: 'Təsvir',
        formats: 'Formatlar',
        readOnline: 'Onlayn oxu',
        download: 'Yüklə',
        views: 'baxış',
        downloads: 'yükləmə'
    }
};

const flagMap = {
    az: './img/az.png',
    ru: './img/ru.png'
};

function applyLang(lang) {
    const t = translations[lang];
    if (!t) return;

    document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (t[key] !== undefined) el.textContent = t[key];
    });

    document.querySelectorAll('[data-key-placeholder]').forEach(el => {
        const key = el.getAttribute('data-key-placeholder');
        if (t[key] !== undefined) el.placeholder = t[key];
    });

    const flagImg = document.getElementById('langFlagImg');
    if (flagImg && flagMap[lang]) flagImg.src = flagMap[lang];

    document.documentElement.lang = lang;
    localStorage.setItem('lang', lang);

    updateLanguageDisplay(lang);

    document.body.classList.add('lang-ready');
    document.dispatchEvent(new Event('langChanged'));
}

function updateLanguageDisplay(lang) {
    document.querySelectorAll('[data-lang-ru]').forEach(el => {
        el.style.display = (lang === 'ru') ? '' : 'none';
    });
    document.querySelectorAll('[data-lang-az]').forEach(el => {
        el.style.display = (lang === 'az') ? '' : 'none';
    });
}

// Пример инициализации:
const savedLang = localStorage.getItem('lang') || 'ru';
updateLanguageDisplay(savedLang);

// Если у вас есть кнопки для смены языка:
document.querySelectorAll('.lang-option').forEach(btn => {
    btn.addEventListener('click', function() {
        const lang = btn.getAttribute('data-lang');
        applyLang(lang); // только applyLang, больше ничего не нужно
        // updateLanguageDisplay(lang); // УДАЛИТЬ эту строку!
        // localStorage.setItem('lang', lang); // УДАЛИТЬ эту строку!
    });
});

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        applyLang(savedLang);
        initLangUI();
    });
} else {
    applyLang(savedLang);
    initLangUI();
}

function initLangUI() {
    const langBtn   = document.getElementById('langBtn');
    const langModal = document.getElementById('langModal');
    const options   = document.querySelectorAll('.lang-option');

    if (langBtn && langModal) {
        langBtn.addEventListener('click', () => langModal.classList.add('active'));
        langModal.addEventListener('click', (e) => {
            if (e.target === langModal) langModal.classList.remove('active');
        });
    }

    options.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            applyLang(lang);
            if (langModal) langModal.classList.remove('active');
        });
    });
}